import { createSlice } from "@reduxjs/toolkit";

export const CardsSlice = createSlice({
  name: "Cards",
  initialState: {
    items: [
      {
        id: "1",
        name: "TC",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/74776-1632346822.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "2",
        name: "TC",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/74776-1632346822.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "3",
        name: "SD",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/big/176961-1545499104.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "4",
        name: "SD",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/big/176961-1545499104.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "5",
        name: "ICK",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/216603-1622208818.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "6",
        name: "ICK",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/216603-1622208818.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "7",
        name: "FO",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/209574-1622801236.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "8",
        name: "FO",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/209574-1622801236.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "9",
        name: "MT",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/17140-1441144417.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "10",
        name: "MT",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/17140-1441144417.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "11",
        name: "AP",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/99186-1634682690.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "12",
        name: "AP",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/99186-1634682690.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "13",
        name: "HC",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/6897-1537453398.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "14",
        name: "HC",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/6897-1537453398.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "15",
        name: "EN",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/15907-1600712207.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "16",
        name: "EN",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/15907-1600712207.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "17",
        name: "AO",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/124891-1600615943.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "18",
        name: "AO",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/124891-1600615943.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "19",
        name: "HT",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/395862-1630526948.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "20",
        name: "HT",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/395862-1630526948.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "21",
        name: "IC",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/282460-1616164761.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "22",
        name: "IC",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/282460-1616164761.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "23",
        name: "KK",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/119557-1626419755.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "24",
        name: "KK",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/119557-1626419755.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "25",
        name: "JL",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/38497-1568300883.JPG?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "26",
        name: "JL",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/38497-1568300883.JPG?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "27",
        name: "AL",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/69374-1568213594.JPG?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "28",
        name: "AL",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/69374-1568213594.JPG?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "29",
        name: "FK",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/79110-1630524608.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "30",
        name: "FK",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/79110-1630524608.png?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "31",
        name: "EI",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/88371-1612445759.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "32",
        name: "EI",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/88371-1612445759.jpeg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "33",
        name: "LO",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/265916-1464122223.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "34",
        name: "LO",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/265916-1464122223.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "35",
        name: "IH",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/74996-1605121766.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
      {
        id: "36",
        name: "IH",
        imgUrl:
          "https://img.a.transfermarkt.technology/portrait/header/74996-1605121766.jpg?lm=1",
        isOpen: false,
        disabled: false,
        locked: false,
      },
    ],
    numberOfTour: 0,
    user1Point: 0,
    user2Point: 0,
    matchedCard: [],
    finish : false,
  },
  reducers: {
    openCard: (state, action) => {
      const { id } = action.payload;
      const sa = state.items.find((item) => item.id === id);
      sa.isOpen = !sa.isOpen;
      sa.disabled = true;
      state.matchedCard.push(sa);
    },
    MatchCard: (state) => {
      if (state.matchedCard.length === 2) {
        if (state.matchedCard[0].name === state.matchedCard[1].name) {
          state.matchedCard = [];
          state.numberOfTour % 2 === 0
            ? state.user1Point += 50
            : state.user2Point += 50;
        } else {
          state.numberOfTour % 2 === 0
            ? state.user1Point -= 10
            : state.user2Point -= 10;

          const it1 = state.items.find((i) => i.id === state.matchedCard[0].id);
          const it2 = state.items.find((i) => i.id === state.matchedCard[1].id);

          it1.isOpen = false;
          it2.isOpen = false;
          it1.disabled = false;
          it2.disabled = false;
          state.matchedCard = [];
        }
        state.numberOfTour += 1;

      }
      state.items.forEach((i) => (i.locked = false));
    },
    lockCard: (state) => {
      state.items.forEach((i) => (i.locked = true));
    },
    shuffleCards: (state) => {
      const newArr = state.items.slice();
      for (let i = newArr.length - 1; i > 0; i--) {
        const rand = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[rand]] = [newArr[rand], newArr[i]];
      }
      state.items = newArr;
    },
  },
});

export default CardsSlice.reducer;
export const { openCard, MatchCard, lockCard, shuffleCards } =
  CardsSlice.actions;
